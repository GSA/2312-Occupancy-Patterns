step_01 <-
in_data %>%
ggplot(aes(
x = !!in_variable_sym,
color = .cluster_5,
fill = .cluster_5
)) +
geom_histogram(alpha = .25) +
geomtextpath::geom_textdensity(
aes(label = .cluster_5),
hjust = "ymax",
vjust = 1,
text_only = TRUE,
text_smoothing = 0,
straight = TRUE
)
}
step_01 +
theme_fivethirtyeight() +
labs(
title = glue::glue("Histogram of `{in_variable}`"),
caption = glue::glue("For {in_cluster_number} clusters.")
) +
theme(
legend.position = "none",
panel.background = element_rect(fill = "white"),
plot.background = element_rect(fill = "white"),
# panel.border = element_blank()
)
}
gg_density(d,"daily_status_teleworking", in_cluster_number = 2)
gg_density(d,"daily_status_teleworking", in_cluster_number = 5)
gg_density(d,"daily_status_teleworking_observation_prop", in_cluster_number = 2)
gg_density(d,"daily_status_teleworking", in_cluster_number = 2)
gg_density <- function(in_data,in_variable,in_cluster_number)
{
in_variable_sym <- sym(in_variable)
# spec <- unique(in_data$specification)
#
# clus <- unique(in_data$k)
if(in_cluster_number==2)
{
step_01 <-
in_data %>%
ggplot(aes(
x = !!in_variable_sym,
color = .cluster_2,
fill = .cluster_2
)) +
geom_density(alpha = .25) +
geomtextpath::geom_textdensity(
aes(label = .cluster_2),
hjust = "ymax",
vjust = 1,
text_only = TRUE,
text_smoothing = 0,
straight = TRUE
)
}
if(in_cluster_number==5)
{
step_01 <-
in_data %>%
ggplot(aes(
x = !!in_variable_sym,
color = .cluster_5,
fill = .cluster_5
)) +
geom_density(alpha = .25) +
geomtextpath::geom_textdensity(
aes(label = .cluster_5),
hjust = "ymax",
vjust = 1,
text_only = TRUE,
text_smoothing = 0,
straight = TRUE
)
}
step_01 +
theme_fivethirtyeight() +
labs(
title = glue::glue("Histogram of `{in_variable}`"),
caption = glue::glue("For {in_cluster_number} clusters.")
) +
theme(
legend.position = "none",
panel.background = element_rect(fill = "white"),
plot.background = element_rect(fill = "white"),
# panel.border = element_blank()
)
}
gg_density(d,"daily_status_teleworking", in_cluster_number = 2)
gg_density(d,"daily_status_reporting_to_job_site_observation_prop", in_cluster_number = 5)
knitr::opts_chunk$set(echo = TRUE)
tictoc::tic()
if(!("arsenal" %in% installed.packages()[,"Package"]))
{
install.packages("arsenal")
}
if(!("geomtextpath" %in% installed.packages()[,"Package"]))
{
install.packages("geomtextpath")
}
if(!("oesrrr" %in% installed.packages()[,"Package"]))
{
devtools::install_github(repo = "GSA/oesrrr")
}
if(!("oesrrr" %in% installed.packages()[,"Package"]))
{
devtools::install_github(repo = "GSA/oesrrr")
}
library(oesrrr)
library(tidyverse)
library(janitor)
library(skimr)
library(DataExplorer)
library(readr)
library(arsenal)
library(Hmisc)
library(readxl)
library(flextable)
library(ggthemes)
library(tidymodels)
library(gtsummary)
knitr::opts_chunk$set(echo = TRUE)
tictoc::tic()
if(!("arsenal" %in% installed.packages()[,"Package"]))
{
install.packages("arsenal")
}
if(!("geomtextpath" %in% installed.packages()[,"Package"]))
{
install.packages("geomtextpath")
}
if(!("oesrrr" %in% installed.packages()[,"Package"]))
{
devtools::install_github(repo = "GSA/oesrrr")
}
if(!("oesrrr" %in% installed.packages()[,"Package"]))
{
devtools::install_github(repo = "GSA/oesrrr")
}
library(oesrrr)
library(tidyverse)
library(janitor)
library(skimr)
library(DataExplorer)
library(readr)
library(arsenal)
library(Hmisc)
library(readxl)
library(flextable)
library(ggthemes)
library(tidymodels)
d %>%
group_by(.cluster_2) %>%
skim(daily_status_reporting_to_job_site,
daily_status_teleworking)
d %>%
group_by(.cluster_2) %>%
skim(daily_status_reporting_to_job_site,
daily_status_teleworking) %>%
as.data.frame()
d %>%
group_by(.cluster_2) %>%
skim(daily_status_reporting_to_job_site,
daily_status_teleworking)
d %>%
group_by(.cluster_2) %>%
skim(daily_status_reporting_to_job_site,
daily_status_reporting_to_job_site_observation_prop,
daily_status_teleworking,
daily_status_teleworking_observation_prop) %>%
as.data.frame()
d %>%
group_by(.cluster_2) %>%
skim(daily_status_reporting_to_job_site,
daily_status_reporting_to_job_site_observation_prop,
daily_status_teleworking,
daily_status_teleworking_observation_prop,
days_colocated_1,
days_colocated_1_observation_prop,
days_colocated_supervisor,
days_colocated_supervisor_observation_prop,
days_colocated_team,
days_colocated_team_observation_prop,
days_telework_team,
days_telework_team_observation_prop,
working_days,
team_size_mode) %>%
as.data.frame()
d %>%
group_by(.cluster_5) %>%
skim(daily_status_reporting_to_job_site,
daily_status_reporting_to_job_site_observation_prop,
daily_status_teleworking,
daily_status_teleworking_observation_prop,
days_colocated_1,
days_colocated_1_observation_prop,
days_colocated_supervisor,
days_colocated_supervisor_observation_prop,
days_colocated_team,
days_colocated_team_observation_prop,
days_telework_team,
days_telework_team_observation_prop,
working_days,
team_size_mode) %>%
as.data.frame()
source("//E04BMK-XDVCFP1/RedirFL$/BenjaminPJaques-Lesl/Desktop/repos/2312-Occupancy-Patterns/04. Analysis/scripts/03-02-data-analysis-employee-cluster-assessment.R", echo=TRUE)
knitr::opts_chunk$set(echo = TRUE)
tictoc::tic()
if(!("arsenal" %in% installed.packages()[,"Package"]))
{
install.packages("arsenal")
}
if(!("oesrrr" %in% installed.packages()[,"Package"]))
{
devtools::install_github(repo = "GSA/oesrrr")
}
library(oesrrr)
library(factoextra)
library(tidyverse)
library(janitor)
library(skimr)
library(DataExplorer)
library(readr)
library(arsenal)
library(Hmisc)
library(readxl)
library(flextable)
library(ggthemes)
library(tidymodels)
library(cluster)
pca <-
specs %>%
slice_head(n = 1) %>%
pmap_dfr(make_fviz_clusters_d)
View(make_fviz_clusters_d)
View(make_fviz_clusters)
make_fviz_clusters_d <- function(in_specification,
in_scale_or_rank,
in_working_or_observation_window,
in_weekday_correlation,
in_number_of_clusters_start,
in_number_of_clusters_end,
in_remove_other_statuses )
{
make_fviz_clusters(
in_data = d,
in_scale_or_rank = in_scale_or_rank,
in_working_or_observation_window = in_working_or_observation_window,
in_weekday_correlation = in_weekday_correlation,
in_number_of_clusters_start = in_number_of_clusters_start,
in_number_of_clusters_end = in_number_of_clusters_end,
in_remove_other_statuses  = in_remove_other_statuses
) %>%
mutate(specification = in_specification)
}
pca <-
specs %>%
slice_head(n = 1) %>%
pmap_dfr(make_fviz_clusters_d)
source("//E04BMK-XDVCFP1/RedirFL$/BenjaminPJaques-Lesl/Desktop/repos/2312-Occupancy-Patterns/04. Analysis/scripts/make_fviz_clusters.R")
pca <-
specs %>%
slice_head(n = 1) %>%
pmap_dfr(make_fviz_clusters_d)
pca %>%
# filter(specification == params$in_specification) %>%
.$fviz_cluster
silhouette_diagrams <-
specs %>%
select(
in_scale_or_rank,
in_working_or_observation_window,
in_weekday_correlation,
in_specification,
in_remove_other_statuses
) %>%
distinct() %>%
slice(rep(1:n(), each = params$in_number_of_clusters_end)) %>%
rownames_to_column(var = "temp_01") %>%
mutate(temp_02 = as.numeric(temp_01),
temp_03 = temp_02/params$in_number_of_clusters_end,
temp_04 = ceiling(temp_03),
temp_05 = temp_04*params$in_number_of_clusters_end-params$in_number_of_clusters_end,
temp_06 = temp_02 - temp_05) %>%
rename(in_clusters = temp_06) %>%
select(-starts_with("temp_")) %>%
filter(in_clusters > 1) %>%
slice(2) %>%
pmap(make_fviz_silhouette_d)
d %>%
group_by(.cluster_2) %>%
skim(daily_status_reporting_to_job_site,
daily_status_reporting_to_job_site_observation_prop,
daily_status_teleworking,
daily_status_teleworking_observation_prop,
days_colocated_1,
days_colocated_1_observation_prop,
days_colocated_supervisor,
days_colocated_supervisor_observation_prop,
days_colocated_team,
days_colocated_team_observation_prop,
days_telework_team,
days_telework_team_observation_prop,
working_days,
team_size_mode) %>%
as.data.frame()
knitr::opts_chunk$set(echo = TRUE)
tictoc::tic()
if(!("arsenal" %in% installed.packages()[,"Package"]))
{
install.packages("arsenal")
}
if(!("geomtextpath" %in% installed.packages()[,"Package"]))
{
install.packages("geomtextpath")
}
if(!("oesrrr" %in% installed.packages()[,"Package"]))
{
devtools::install_github(repo = "GSA/oesrrr")
}
if(!("oesrrr" %in% installed.packages()[,"Package"]))
{
devtools::install_github(repo = "GSA/oesrrr")
}
library(oesrrr)
library(tidyverse)
library(janitor)
library(skimr)
library(DataExplorer)
library(readr)
library(arsenal)
library(Hmisc)
library(readxl)
library(flextable)
library(ggthemes)
library(tidymodels)
# date_cohort_month_start <- ymd(params$date_cohort_month)
# date_cohort_month_end <- ceiling_date(date_cohort_month_start,unit = "month") %>% rollbackward()
# date_observation_window_month_start <- date_cohort_month_start %m+% months(params$observation_window_length_months)
# date_observation_window_month_end <- ceiling_date(date_observation_window_month_start,unit = "month") %>% rollbackward()
load(file = file.path(params$google_drive_home,"03. Data Collection",params$data_folder_1,params$data_file_1))
kclusts %>%
skim()
load(file = file.path(params$google_drive_home,"03. Data Collection",params$data_folder_1,params$data_file_2))
prep_employees %>%
skim()
clust_1 <-
kclusts %>%
filter(
k == params$in_number_of_clusters_1 &
specification == params$in_specification
)
clust_2 <-
kclusts %>%
filter(
k == params$in_number_of_clusters_2 &
specification == params$in_specification
)
clusters_1 <-
clust_1 %>%
unnest(cols = c(tidied))
assignments_1 <-
clust_1 %>%
unnest(cols = c(augmented))
clusterings_1 <-
clust_1 %>%
unnest(cols = c(glanced))
assignments_1 %>%
glimpse()
clusters_2 <-
clust_2 %>%
unnest(cols = c(tidied))
assignments_2 <-
clust_2 %>%
unnest(cols = c(augmented))
clusterings_2 <-
clust_2 %>%
unnest(cols = c(glanced))
assignments_2 %>%
glimpse()
rename_to_k <- function(in_data)
{
tot_cluster <- in_data %>% select(k) %>% distinct() %>% pull()
out_data <-
in_data %>% rename_with( ~ glue::glue("{.x}_{tot_cluster}"), .cluster)
return(out_data)
}
assignments <-
assignments_1 %>%
rename_to_k() %>%
select(person_id, starts_with(".cluster")) %>%
full_join(assignments_2 %>%
rename_to_k() %>%
select(person_id, starts_with(".cluster")))
assignments %>%
glimpse()
d <-
assignments %>%
select(person_id, starts_with(".cluster")) %>%
full_join(prep_employees) %>%
mutate(
across(
.cols = starts_with(".cluster"),
.fns = ~fct_na_value_to_level(., level = "(Missing)")
)
)
d %>%
skim()
d %>%
group_by(.cluster_2) %>%
skim(daily_status_reporting_to_job_site,
daily_status_reporting_to_job_site_observation_prop,
daily_status_teleworking,
daily_status_teleworking_observation_prop,
days_colocated_1,
days_colocated_1_observation_prop,
days_colocated_supervisor,
days_colocated_supervisor_observation_prop,
days_colocated_team,
days_colocated_team_observation_prop,
days_telework_team,
days_telework_team_observation_prop,
working_days,
team_size_mode) %>%
as.data.frame()
options(scipen=999)
d %>%
group_by(.cluster_2) %>%
skim(daily_status_reporting_to_job_site,
daily_status_reporting_to_job_site_observation_prop,
daily_status_teleworking,
daily_status_teleworking_observation_prop,
days_colocated_1,
days_colocated_1_observation_prop,
days_colocated_supervisor,
days_colocated_supervisor_observation_prop,
days_colocated_team,
days_colocated_team_observation_prop,
days_telework_team,
days_telework_team_observation_prop,
working_days,
team_size_mode) %>%
as.data.frame()
d %>%
group_by(.cluster_5) %>%
skim(daily_status_reporting_to_job_site,
daily_status_reporting_to_job_site_observation_prop,
daily_status_teleworking,
daily_status_teleworking_observation_prop,
days_colocated_1,
days_colocated_1_observation_prop,
days_colocated_supervisor,
days_colocated_supervisor_observation_prop,
days_colocated_team,
days_colocated_team_observation_prop,
days_telework_team,
days_telework_team_observation_prop,
working_days,
team_size_mode) %>%
as.data.frame()
names(d)
d %>%
group_by(.cluster_5) %>%
skim(exit_employment) %>%
as.data.frame()
d %>%
group_by(.cluster_2) %>%
skim(exit_employment) %>%
as.data.frame()
d %>%
group_by(.cluster_5) %>%
skim(exit_employment,
multiple_supervisors) %>%
as.data.frame()
d %>%
group_by(.cluster_2) %>%
skim(exit_employment,
multiple_supervisors) %>%
as.data.frame()
d %>%
group_by(.cluster_5) %>%
skim(starts_with("rule_based_"),
exit_employment,
multiple_supervisors) %>%
as.data.frame()
d %>%
group_by(.cluster_5) %>%
skim(starts_with("rule_based_"),
-ends_with("working")) %>%
as.data.frame()
d %>%
group_by(.cluster_5) %>%
skim(exit_employment,
multiple_supervisors,
gsa_region) %>%
as.data.frame()
d %>%
group_by(.cluster_5) %>%
skim(exit_employment,
multiple_supervisors,
gsa_region)
d %>%
group_by(.cluster_2) %>%
skim(exit_employment,
multiple_supervisors,
gsa_sso) %>%
as.data.frame()
source("//E04BMK-XDVCFP1/RedirFL$/BenjaminPJaques-Lesl/Desktop/repos/2312-Occupancy-Patterns/04. Analysis/scripts/02_data_preparation_clusters_employee.R", echo=TRUE)
source("//E04BMK-XDVCFP1/RedirFL$/BenjaminPJaques-Lesl/Desktop/repos/2312-Occupancy-Patterns/04. Analysis/scripts/03-01-data-analysis-employee-cluster-identification.R", echo=TRUE)
